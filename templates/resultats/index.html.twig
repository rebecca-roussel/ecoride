{# templates/resultats/index.html.twig #}
{# Plan (structure de la page resultats/index.html.twig) :

  1. En-tête : fourni par base.html.twig
     - fragment : fragments/entete_public.html.twig

  2. Zone centrale (contenu principal) :
     - un grand panneau beige centré (panneau_resultats)
     - titre de la page : "Résultats de recherche"
     - ligne de rappel : Départ / Arrivée / Date / Heure
     - zone d’actions : bouton "Filtrer les résultats"

  3. Liste des résultats :
     - une liste de cartes de covoiturage empilées
     - chaque carte contient :
       b. informations conducteur :
          - photo + pseudo + étoile + note
          - préférences du chauffeur (ex : non-fumeur / sans animaux)
       c. informations covoiturage :
          - trajet (Départ → Arrivée)
          - date et heure
       d. détails bas :
          - énergie / carburant (si électrique : afficher "écologique" dans le texte)
          - places restantes
          - prix en crédits
       e. action :
          - bouton/lien "Voir détails" vers la page "Détails du covoiturage"

  4. Pied de page : fourni par base.html.twig
     - fragment : fragments/pied_de_page.html.twig
#}

{% extends 'base.html.twig' %}

{% block title %}Résultats de recherche - EcoRide{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('css/accueil.css') }}">
  <link rel="stylesheet" href="{{ asset('css/resultats.css') }}">
{% endblock %}

{% block entete %}
  {% include 'fragments/entete_public.html.twig' %}
{% endblock %}

{% block body %}

  <main class="page_resultats">
    <section class="panneau_resultats" aria-labelledby="titre_resultats">

      <h1 id="titre_resultats">Résultats de recherche</h1>

      <p class="rappel_recherche">
        {% if criteres is defined and (criteres.depart or criteres.arrivee or criteres.date_depart or criteres.heure_depart) %}
          Départ : {{ criteres.depart ?: '—' }} - Arrivée : {{ criteres.arrivee ?: '—' }}
          {% if criteres.date_depart %} — Le {{ criteres.date_depart }}{% endif %}
          {% if criteres.heure_depart %} autour de {{ criteres.heure_depart }}{% endif %}
        {% else %}
          Départ : — - Arrivée : — — Le — autour de — 
        {% endif %}
      </p>

      <div class="actions_resultats">
        <button type="button" class="bouton_principal">Filtrer les résultats</button>
      </div>

      <div class="liste_covoiturages">

        {% if covoiturages is defined and covoiturages|length > 0 %}
          {% for c in covoiturages %}
            <article class="carte_covoiturage">
              <div class="bloc_chauffeur">

{# Photo : en attendant le champ photo_path en base, on met une image de démo stable #}
                <img
                  class="photo_profil"
                  src="{{ asset('images/img_muriel.jpg') }}"
                  alt="Photo de {{ c.pseudo_chauffeur }}"
                >

                <div class="chauffeur_texte">
                  <div class="ligne_identite">
                    <span class="pseudo_chauffeur">{{ c.pseudo_chauffeur }}</span>

{# Note : Placeholder neutre, viendra via la table avis plus tard #}
                    <span class="note_chauffeur" aria-label="Note non disponible pour l’instant">
                      <span class="etoile" aria-hidden="true">★</span>
                      <span class="valeur_note">—</span>
                    </span>
                  </div>
                  
{# Préférences du chauffeur (ex : non-fumeur, sans animaux) #}
                  <p class="preferences_chauffeur texte_secondaire">Préférences : —</p>

                  <div class="contenu_carte">
                    <p class="trajet">{{ c.ville_depart }} → {{ c.ville_arrivee }}</p>

                    <p class="date_heure">
                      {{ c.date_heure_depart|date('d/m/Y \\à H:i') }}
                    </p>

                    <p class="details_bas">
                      <span class="energie">
                        Énergie :
                        {% set energie = c.energie ?? '' %}
                        {% if energie %}
                          {{ energie }}{% if energie == 'ELECTRIQUE' %} (écologique){% endif %}
                        {% else %}
                          — 
                        {% endif %}
                      </span>

                      <span class="separateur" aria-hidden="true">•</span>

                      <span class="places texte_secondaire">
                        {{ c.nb_places_dispo }} place{% if c.nb_places_dispo > 1 %}s{% endif %}
                        restante{% if c.nb_places_dispo > 1 %}s{% endif %}
                      </span>

                      <span class="separateur" aria-hidden="true">•</span>

                      <span class="prix">{{ c.prix_credits }} crédits</span>
                    </p>
                  </div>
                </div>
              </div>

              <div class="zone_bouton_details">
                <a class="bouton_principal bouton_details" href="{{ path('details', {'id': c.id_covoiturage}) }}">Voir détails</a>
              </div>
            </article>
          {% endfor %}

        {% else %}
{# Résultats vides : aucun covoiturage trouvé #}
          <article class="carte_covoiturage">
            <div class="bloc_chauffeur">
              <div class="chauffeur_texte">
                <div class="ligne_identite">
                  <span class="pseudo_chauffeur">Aucun covoiturage disponible</span>
                </div>

                <div class="contenu_carte">
                  <p class="trajet">
                    {% if criteres is defined and (criteres.depart or criteres.arrivee or criteres.date_depart) %}
                      Essayez de modifier la date de départ ou les villes.
                    {% else %}
                      Renseignez une ville de départ, une ville d’arrivée et une date pour lancer la recherche.
                    {% endif %}
                  </p>
                </div>
              </div>
            </div>
          </article>
        {% endif %}

      </div>

    </section>
  </main>

{% endblock %}

{% block pied_de_page %}
  {% include 'fragments/pied_de_page.html.twig' %}
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  {# Si nécessaire, un script spécifique pour les résultats #}
  {# <script src="{{ asset('js/resultats.js') }}" defer></script> #}
{% endblock %}
